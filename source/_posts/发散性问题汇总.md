---
title: 发散性问题汇总
categories: java进阶之路
date: 2021-03-29 23:17:46
tags:
  - java 
  - 面试
  - 发散性问题
---

# 如何从100亿URL中找出相同的URL？

## 题目描述

- 给定a、b两个文件，各存放50亿个URL，每个URL各占64B，内存限制是4G。请找出a、b两个文件共同的URL。

## 解答思路

- 每个URL占64B，那么50亿个URL占用空间大约为320GB。
- 5000000000_64B≈5GB_64=320GB
- 由于内存大小只有4G，因此我们不可能一次性将所有URL加载到内存中进行处理。对于这类型题目，一般采用分治策略，即：把一个文件中的URL按照某个特征划分为多个小文件，使得每个小文件大小不超过4G，这样就可以把这些小文件读到内存中进行处理了。

## 思路如下

1. 首先遍历文件a，对遍历到的URL求hash(URL)%1000,根据计算结果把遍历到的URL存储到a0,a1,a2,...,a999,这样每个大小约为300MB。

   ```java
   字符串对象的哈希码根据以下公式计算：
   public int hashCode(){
   	int h = hash;
       if(h ==0 && value.length > 0){
           char val[] = value;
           for(int i = 0; i< value.length; i++){
               //31为奇素数，31*i == (i<<5) - i
               h = 31 * h + val[i];
           }
           hash = h;
       }
       return h;
   }
   ```

2. 使用同样的方法遍历文件b，把文件b中的URL分别存储到文件b0,b1,b2,...,b999中。

3. 这样处理过后，所有可能相同的URL都在对应的小文件中，即a0对应的b0,...,a999对应的 b999，不对应的小文件中不可能有相同的URL。

4. 那么接下来，我们只需要求出这1000对小文件中相同的URL就好了。

5. 紧接着遍历ai(i∈[0,999]),把URL存储到一个HashSet集合中。

6. 然后遍历bi中每一个URL，看在HashSet集合中是否存在，若存在，说明这就是共同的URL，把这个URL保存到一个单独的文件中。

